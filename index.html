<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Mission Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans SC', sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .task-card { transition: all 0.3s; }
        .task-card:hover { transform: translateY(-2px); background: rgba(255,255,255,0.1); }
        .status-running { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .btn-edit { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        input, select, textarea { background: rgba(255,255,255,0.1) !important; border: 1px solid rgba(255,255,255,0.2) !important; color: white !important; }
        input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.5) !important; }
        option { background: #1a1a2e !important; color: white !important; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white">ğŸ¯ Mission Center</h1>
                <p class="text-gray-400 text-sm mt-1">ä»»åŠ¡æŒ‡æŒ¥ä¸­å¿ƒ</p>
            </div>
            <button onclick="openNewTaskModal()" class="btn-primary px-6 py-2 rounded-xl text-white font-medium">
                + æ–°å»ºä»»åŠ¡
            </button>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-4 gap-4 mb-6">
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-green-400" id="totalTasks">0</div>
                <div class="text-gray-400 text-sm">æ€»ä»»åŠ¡æ•°</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-blue-400" id="activeTasks">0</div>
                <div class="text-gray-400 text-sm">è¿è¡Œä¸­</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-yellow-400" id="pendingTasks">0</div>
                <div class="text-gray-400 text-sm">å¾…æ‰§è¡Œ</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-red-400" id="errorTasks">0</div>
                <div class="text-gray-400 text-sm">é”™è¯¯</div>
            </div>
        </div>

        <!-- Task List -->
        <div class="glass rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-bold text-white mb-4">ğŸ“‹ ä»»åŠ¡åˆ—è¡¨</h2>
            <div id="taskList" class="space-y-3"></div>
        </div>

        <!-- Available Tools -->
        <div class="glass rounded-2xl p-6">
            <h2 class="text-xl font-bold text-white mb-4">ğŸ”§ å¯ç”¨å·¥å…·</h2>
            <div class="grid grid-cols-4 gap-3" id="toolsList">
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸŒ Browser</div>
                    <div class="text-gray-400 text-sm">ç½‘é¡µæµè§ˆã€æˆªå›¾ã€è‡ªåŠ¨åŒ–</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ” Web Search</div>
                    <div class="text-gray-400 text-sm">Braveæœç´¢API</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ“° RSS</div>
                    <div class="text-gray-400 text-sm">RSSç›‘æ§è®¢é˜…</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ¦ Twitter</div>
                    <div class="text-gray-400 text-sm">X/Twitterè¯»å†™</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ’¬ Feishu</div>
                    <div class="text-gray-400 text-sm">é£ä¹¦æ¶ˆæ¯/æ–‡æ¡£</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">â° Cron</div>
                    <div class="text-gray-400 text-sm">å®šæ—¶ä»»åŠ¡è°ƒåº¦</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ’» Exec</div>
                    <div class="text-gray-400 text-sm">å‘½ä»¤è¡Œæ‰§è¡Œ</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ“ Memory</div>
                    <div class="text-gray-400 text-sm">é•¿æœŸè®°å¿†å­˜å‚¨</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ™ GitHub</div>
                    <div class="text-gray-400 text-sm">Git/ä»“åº“æ“ä½œ</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ“§ Email</div>
                    <div class="text-gray-400 text-sm">é‚®ä»¶æ”¶å‘</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">â˜ï¸ Cloud</div>
                    <div class="text-gray-400 text-sm">iCloudäº‘ç›˜</div>
                </div>
                <div class="glass rounded-xl p-3">
                    <div class="font-medium text-white">ğŸ¤– AI</div>
                    <div class="text-gray-400 text-sm">å¤§æ¨¡å‹å¯¹è¯</div>
                </div>
            </div>
        </div>
    </div>

    <!-- New/Edit Task Modal -->
    <div id="taskModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center p-4 z-50">
        <div class="glass p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <h2 id="modalTitle" class="text-xl font-bold text-white mb-4">â• æ–°å»ºä»»åŠ¡</h2>
            <form id="taskForm" onsubmit="saveTask(event)">
                <input type="hidden" id="taskId">
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">ä»»åŠ¡åç§° *</label>
                        <input type="text" id="taskName" required class="w-full p-3 rounded-xl" placeholder="ä¾‹å¦‚ï¼šæ¯æ—¥æ—©æŠ¥">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">ä»»åŠ¡æè¿°</label>
                        <textarea id="taskDesc" rows="2" class="w-full p-3 rounded-xl" placeholder="ä»»åŠ¡è¯¦ç»†æè¿°"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-400 text-sm mb-1">è§¦å‘ç±»å‹</label>
                            <select id="triggerType" class="w-full p-3 rounded-xl" onchange="toggleSchedule()">
                                <option value="cron">Cronè¡¨è¾¾å¼</option>
                                <option value="interval">é—´éš”æ‰§è¡Œ</option>
                                <option value="manual">æ‰‹åŠ¨è§¦å‘</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-400 text-sm mb-1">æ‰§è¡Œæ—¶é—´</label>
                            <input type="text" id="schedule" class="w-full p-3 rounded-xl" placeholder="0 7 * * *">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">ä½¿ç”¨å·¥å…·ï¼ˆå¤šé€‰ï¼‰</label>
                        <div class="flex flex-wrap gap-2" id="toolCheckboxes">
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg cursor-pointer">
                                <input type="checkbox" name="tools" value="browser"> ğŸŒ æµè§ˆå™¨
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg cursor-pointer">
                                <input type="checkbox" name="tools" value="web_search"> ğŸ” æœç´¢
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="rss"> ğŸ“° RSS
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="twitter"> ğŸ¦ Twitter
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="feishu"> ğŸ’¬ é£ä¹¦
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="github"> ğŸ™ GitHub
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="exec"> ğŸ’» å‘½ä»¤è¡Œ
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="memory"> ğŸ“ è®°å¿†
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">è¾“å‡ºç›®æ ‡</label>
                        <select id="outputTarget" class="w-full p-3 rounded-xl">
                            <option value="feishu">é£ä¹¦ç§ä¿¡</option>
                            <option value="github">GitHub</option>
                            <option value="both">é£ä¹¦+GitHub</option>
                            <option value="none">ä»…æ‰§è¡Œ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Prompt/æŒ‡ä»¤</label>
                        <textarea id="taskPrompt" rows="4" class="w-full p-3 rounded-xl" placeholder="ä»»åŠ¡æ‰§è¡Œçš„å…·ä½“æŒ‡ä»¤..."></textarea>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeModal()" class="flex-1 p-3 bg-white/10 rounded-xl text-white">å–æ¶ˆ</button>
                    <button type="submit" class="flex-1 btn-primary p-3 rounded-xl text-white font-medium">ä¿å­˜ä»»åŠ¡</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Task data
        let tasks = [
            { id: 1, name: 'è¡Œä¸šæ—©æŠ¥', desc: 'æ¯å¤©7:00ç”ŸæˆAI/æœºå™¨äººè¡Œä¸šæ—©æŠ¥', trigger: 'cron 0 7 * * *', tools: ['browser','web_search','rss','twitter','feishu','github'], status: 'pending', lastRun: '2026-02-20 07:00', prompt: 'ç”Ÿæˆè¡Œä¸šæ—©æŠ¥...' },
            { id: 2, name: 'çµæ„Ÿåº“å»ºè®®', desc: 'æ£€æµ‹æ–°çµæ„Ÿå¹¶ç”Ÿæˆåˆ›ä½œå»ºè®®', trigger: 'interval 5min', tools: ['github','feishu'], status: 'running', lastRun: '2026-02-20 17:05', prompt: 'æ£€æŸ¥çµæ„Ÿç”Ÿæˆå»ºè®®...' },
            { id: 3, name: 'AIå­¦ä¹ æé†’', desc: 'æ¯å¤©10:00æé†’å­¦ä¹ ', trigger: 'cron 0 10 * * *', tools: ['feishu'], status: 'pending', lastRun: '2026-02-20 10:00', prompt: 'æé†’å­¦ä¹ ...' },
            { id: 4, name: 'å‘¨æŠ¥ç”Ÿæˆ', desc: 'æ¯å‘¨ä¸€8:00ç”Ÿæˆå‘¨æŠ¥', trigger: 'cron 0 8 * * 1', tools: ['web_search','feishu','github'], status: 'pending', lastRun: '2026-02-16 08:00', prompt: 'ç”Ÿæˆå‘¨æŠ¥...' }
        ];

        // Load from localStorage
        function loadTasks() {
            const saved = localStorage.getItem('missionTasks');
            if (saved) tasks = JSON.parse(saved);
        }
        loadTasks();

        function saveTasks() {
            localStorage.setItem('missionTasks', JSON.stringify(tasks));
        }

        function render() {
            // Stats
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('activeTasks').textContent = tasks.filter(t => t.status === 'running').length;
            document.getElementById('pendingTasks').textContent = tasks.filter(t => t.status === 'pending').length;
            document.getElementById('errorTasks').textContent = tasks.filter(t => t.status === 'error').length;

            // Task list
            const list = document.getElementById('taskList');
            if (tasks.length === 0) {
                list.innerHTML = '<div class="text-gray-500 text-center py-8">æš‚æ— ä»»åŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹"+ æ–°å»ºä»»åŠ¡"åˆ›å»º</div>';
                return;
            }

            list.innerHTML = tasks.map(t => `
                <div class="task-card glass rounded-xl p-4 flex justify-between items-center">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="text-white font-medium">${t.name}</span>
                            <span class="px-2 py-0.5 rounded-full text-xs ${
                                t.status === 'running' ? 'bg-green-500/20 text-green-400 status-running' :
                                t.status === 'error' ? 'bg-red-500/20 text-red-400' :
                                'bg-yellow-500/20 text-yellow-400'
                            }">${t.status === 'running' ? 'è¿è¡Œä¸­' : t.status === 'error' ? 'é”™è¯¯' : 'å¾…æ‰§è¡Œ'}</span>
                        </div>
                        <div class="text-gray-400 text-sm mt-1">${t.desc || 'æ— æè¿°'}</div>
                        <div class="text-gray-500 text-xs mt-1">â° ${t.trigger} | ğŸ”§ ${(t.tools || []).join(', ')}</div>
                    </div>
                    <div class="text-right flex flex-col gap-2">
                        <div class="text-gray-400 text-sm">ä¸Šæ¬¡: ${t.lastRun}</div>
                        <div class="flex gap-2">
                            <button onclick="editTask(${t.id})" class="btn-edit px-3 py-1 rounded-lg text-sm text-white">ç¼–è¾‘</button>
                            <button onclick="runTask(${t.id})" class="btn-success px-3 py-1 rounded-lg text-sm text-white">æ‰§è¡Œ</button>
                            <button onclick="deleteTask(${t.id})" class="bg-red-500/20 text-red-400 px-3 py-1 rounded-lg text-sm">åˆ é™¤</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openNewTaskModal() {
            document.getElementById('modalTitle').textContent = 'â• æ–°å»ºä»»åŠ¡';
            document.getElementById('taskId').value = '';
            document.getElementById('taskForm').reset();
            document.getElementById('taskModal').classList.remove('hidden');
            document.getElementById('taskModal').classList.add('flex');
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            document.getElementById('modalTitle').textContent = 'âœï¸ ç¼–è¾‘ä»»åŠ¡';
            document.getElementById('taskId').value = task.id;
            document.getElementById('taskName').value = task.name;
            document.getElementById('taskDesc').value = task.desc || '';
            document.getElementById('taskPrompt').value = task.prompt || '';
            
            const triggerMatch = task.trigger.match(/^(\w+)\s+(.+)$/);
            if (triggerMatch) {
                document.getElementById('triggerType').value = triggerMatch[1] === 'interval' ? 'interval' : 'cron';
                document.getElementById('schedule').value = triggerMatch[2] || '';
            }
            
            document.getElementById('outputTarget').value = task.output || 'feishu';
            
            // Check tools
            document.querySelectorAll('input[name="tools"]').forEach(cb => {
                cb.checked = (task.tools || []).includes(cb.value);
            });
            
            document.getElementById('taskModal').classList.remove('hidden');
            document.getElementById('taskModal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('taskModal').classList.add('hidden');
            document.getElementById('taskModal').classList.remove('flex');
        }

        function toggleSchedule() {
            const type = document.getElementById('triggerType').value;
            const schedule = document.getElementById('schedule');
            if (type === 'manual') {
                schedule.value = 'æ‰‹åŠ¨';
                schedule.disabled = true;
            } else {
                schedule.disabled = false;
                if (type === 'interval' && !schedule.value) schedule.value = '5min';
                if (type === 'cron' && !schedule.value) schedule.value = '0 7 * * *';
            }
        }

        function saveTask(e) {
            e.preventDefault();
            const id = document.getElementById('taskId').value;
            const name = document.getElementById('taskName').value;
            const desc = document.getElementById('taskDesc').value;
            const prompt = document.getElementById('taskPrompt').value;
            const triggerType = document.getElementById('triggerType').value;
            const schedule = document.getElementById('schedule').value;
            const output = document.getElementById('outputTarget').value;
            const tools = Array.from(document.querySelectorAll('input[name="tools"]:checked')).map(cb => cb.value);

            const trigger = triggerType === 'manual' ? 'æ‰‹åŠ¨' : 
                           triggerType === 'interval' ? `interval ${schedule}` : 
                           `cron ${schedule}`;

            if (id) {
                // Edit existing
                const task = tasks.find(t => t.id === parseInt(id));
                if (task) {
                    task.name = name;
                    task.desc = desc;
                    task.prompt = prompt;
                    task.trigger = trigger;
                    task.tools = tools.length ? tools : ['manual'];
                    task.output = output;
                }
            } else {
                // New task
                tasks.push({
                    id: Date.now(),
                    name,
                    desc,
                    prompt,
                    trigger,
                    tools: tools.length ? tools : ['manual'],
                    output,
                    status: 'pending',
                    lastRun: '-'
                });
            }

            saveTasks();
            render();
            closeModal();
        }

        function runTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = 'running';
                task.lastRun = new Date().toLocaleString('zh-CN');
                render();
                saveTasks();
                // Simulate completion
                setTimeout(() => {
                    task.status = 'pending';
                    render();
                    saveTasks();
                }, 3000);
            }
        }

        function deleteTask(id) {
            if (confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
                tasks = tasks.filter(t => t.id !== id);
                saveTasks();
                render();
            }
        }

        // Auto-refresh
        render();
        setInterval(render, 5000);
    </script>
</body>
</html>
