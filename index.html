<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ Mission Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans SC', sans-serif; }
        body { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); min-height: 100vh; }
        .glass { background: rgba(255,255,255,0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); }
        .task-card { transition: all 0.3s; }
        .task-card:hover { transform: translateY(-2px); background: rgba(255,255,255,0.1); }
        .status-running { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .btn-edit { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        input, select, textarea { background: rgba(255,255,255,0.1) !important; border: 1px solid rgba(255,255,255,0.2) !important; color: white !important; }
        input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.5) !important; }
        option { background: #1a1a2e !important; color: white !important; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-3xl font-bold text-white">ğŸ¯ Mission Center</h1>
                <p class="text-gray-400 text-sm mt-1">ä»»åŠ¡æŒ‡æŒ¥ä¸­å¿ƒ</p>
            </div>
            <button onclick="openNewTaskModal()" class="btn-primary px-6 py-2 rounded-xl text-white font-medium">
                + æ–°å»ºä»»åŠ¡
            </button>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-4 gap-4 mb-6">
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-green-400" id="totalTasks">0</div>
                <div class="text-gray-400 text-sm">æ€»ä»»åŠ¡æ•°</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-blue-400" id="activeTasks">0</div>
                <div class="text-gray-400 text-sm">è¿è¡Œä¸­</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-yellow-400" id="pendingTasks">0</div>
                <div class="text-gray-400 text-sm">å¾…æ‰§è¡Œ</div>
            </div>
            <div class="glass rounded-xl p-4 text-center">
                <div class="text-3xl font-bold text-red-400" id="errorTasks">0</div>
                <div class="text-gray-400 text-sm">é”™è¯¯</div>
            </div>
        </div>

        <!-- Task List -->
        <div class="glass rounded-2xl p-6 mb-6">
            <h2 class="text-xl font-bold text-white mb-4">ğŸ“‹ ä»»åŠ¡åˆ—è¡¨</h2>
            <div id="taskList" class="space-y-3"></div>
        </div>

        <!-- Available Tools -->
        <div class="glass rounded-2xl p-6">
            <h2 class="text-xl font-bold text-white mb-4">ğŸ”§ å¯ç”¨å·¥å…·</h2>
            <div class="grid grid-cols-4 gap-3" id="toolsList">
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('browser')">
                    <div class="font-medium text-white">ğŸŒ Browser</div>
                    <div class="text-gray-400 text-sm">ç½‘é¡µæµè§ˆã€æˆªå›¾ã€è‡ªåŠ¨åŒ–</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('web_search')">
                    <div class="font-medium text-white">ğŸ” Web Search</div>
                    <div class="text-gray-400 text-sm">Braveæœç´¢API</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('rss')">
                    <div class="font-medium text-white">ğŸ“° RSS</div>
                    <div class="text-gray-400 text-sm">RSSç›‘æ§è®¢é˜…</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('twitter')">
                    <div class="font-medium text-white">ğŸ¦ Twitter</div>
                    <div class="text-gray-400 text-sm">X/Twitterè¯»å†™</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('feishu')">
                    <div class="font-medium text-white">ğŸ’¬ Feishu</div>
                    <div class="text-gray-400 text-sm">é£ä¹¦æ¶ˆæ¯/æ–‡æ¡£</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('cron')">
                    <div class="font-medium text-white">â° Cron</div>
                    <div class="text-gray-400 text-sm">å®šæ—¶ä»»åŠ¡è°ƒåº¦</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('exec')">
                    <div class="font-medium text-white">ğŸ’» Exec</div>
                    <div class="text-gray-400 text-sm">å‘½ä»¤è¡Œæ‰§è¡Œ</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('memory')">
                    <div class="font-medium text-white">ğŸ“ Memory</div>
                    <div class="text-gray-400 text-sm">é•¿æœŸè®°å¿†å­˜å‚¨</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('github')">
                    <div class="font-medium text-white">ğŸ™ GitHub</div>
                    <div class="text-gray-400 text-sm">Git/ä»“åº“æ“ä½œ</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('email')">
                    <div class="font-medium text-white">ğŸ“§ Email</div>
                    <div class="text-gray-400 text-sm">é‚®ä»¶æ”¶å‘</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('cloud')">
                    <div class="font-medium text-white">â˜ï¸ Cloud</div>
                    <div class="text-gray-400 text-sm">iCloudäº‘ç›˜</div>
                </div>
                <div class="glass rounded-xl p-3 cursor-pointer hover:bg-white/10" onclick="showToolDetail('ai')">
                    <div class="font-medium text-white">ğŸ¤– AI</div>
                    <div class="text-gray-400 text-sm">å¤§æ¨¡å‹å¯¹è¯</div>
                </div>
            </div>
        </div>
    </div>

    <!-- New/Edit Task Modal -->
    <div id="taskModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center p-4 z-50">
        <div class="glass p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <h2 id="modalTitle" class="text-xl font-bold text-white mb-4">â• æ–°å»ºä»»åŠ¡</h2>
            <form id="taskForm" onsubmit="saveTask(event)">
                <input type="hidden" id="taskId">
                <div class="space-y-4">
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">ä»»åŠ¡åç§° *</label>
                        <input type="text" id="taskName" required class="w-full p-3 rounded-xl" placeholder="ä¾‹å¦‚ï¼šæ¯æ—¥æ—©æŠ¥">
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">ä»»åŠ¡æè¿°</label>
                        <textarea id="taskDesc" rows="2" class="w-full p-3 rounded-xl" placeholder="ä»»åŠ¡è¯¦ç»†æè¿°"></textarea>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-400 text-sm mb-1">æ‰§è¡Œé¢‘ç‡</label>
                            <select id="schedulePreset" class="w-full p-3 rounded-xl" onchange="toggleSchedule()">
                                <option value="">è‡ªå®šä¹‰</option>
                                <option value="0 7 * * *">æ¯å¤© æ—©ä¸Š7ç‚¹</option>
                                <option value="0 10 * * *">æ¯å¤© æ—©ä¸Š10ç‚¹</option>
                                <option value="0 18 * * *">æ¯å¤© ä¸‹åˆ6ç‚¹</option>
                                <option value="0 8 * * 1">æ¯å‘¨ä¸€ æ—©ä¸Š8ç‚¹</option>
                                <option value="*/5 * * * *">æ¯5åˆ†é’Ÿ</option>
                                <option value="*/15 * * * *">æ¯15åˆ†é’Ÿ</option>
                                <option value="*/30 * * * *">æ¯30åˆ†é’Ÿ</option>
                                <option value="manual">æ‰‹åŠ¨è§¦å‘</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-400 text-sm mb-1">è‡ªå®šä¹‰æ—¶é—´</label>
                            <input type="text" id="schedule" class="w-full p-3 rounded-xl" placeholder="å¦‚: æ¯å¤© 8ç‚¹">
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">ä½¿ç”¨å·¥å…·ï¼ˆå¤šé€‰ï¼‰</label>
                        <div class="flex flex-wrap gap-2" id="toolCheckboxes">
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg cursor-pointer">
                                <input type="checkbox" name="tools" value="browser"> ğŸŒ æµè§ˆå™¨
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg cursor-pointer">
                                <input type="checkbox" name="tools" value="web_search"> ğŸ” æœç´¢
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="rss"> ğŸ“° RSS
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="twitter"> ğŸ¦ Twitter
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="feishu"> ğŸ’¬ é£ä¹¦
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="github"> ğŸ™ GitHub
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="exec"> ğŸ’» å‘½ä»¤è¡Œ
                            </label>
                            <label class="flex items-center gap-2 text-white bg-white/10 px-3 py-1 rounded-lg">
                                <input type="checkbox" name="tools" value="memory"> ğŸ“ è®°å¿†
                            </label>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">è¾“å‡ºç›®æ ‡</label>
                        <select id="outputTarget" class="w-full p-3 rounded-xl">
                            <option value="feishu">é£ä¹¦ç§ä¿¡</option>
                            <option value="github">GitHub</option>
                            <option value="both">é£ä¹¦+GitHub</option>
                            <option value="none">ä»…æ‰§è¡Œ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 text-sm mb-1">Prompt/æŒ‡ä»¤</label>
                        <textarea id="taskPrompt" rows="4" class="w-full p-3 rounded-xl" placeholder="ä»»åŠ¡æ‰§è¡Œçš„å…·ä½“æŒ‡ä»¤..."></textarea>
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button type="button" onclick="closeModal()" class="flex-1 p-3 bg-white/10 rounded-xl text-white">å–æ¶ˆ</button>
                    <button type="submit" class="flex-1 btn-primary p-3 rounded-xl text-white font-medium">ä¿å­˜ä»»åŠ¡</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Task data
        let tasks = [
            { id: 1, name: 'è¡Œä¸šæ—©æŠ¥', desc: 'æ¯å¤©7:00ç”ŸæˆAI/æœºå™¨äººè¡Œä¸šæ—©æŠ¥', trigger: 'cron 0 7 * * *', tools: ['browser','web_search','rss','twitter','feishu','github'], status: 'pending', lastRun: '2026-02-20 07:00', prompt: 'ç”Ÿæˆè¡Œä¸šæ—©æŠ¥...' },
            { id: 2, name: 'çµæ„Ÿåº“å»ºè®®', desc: 'æ£€æµ‹æ–°çµæ„Ÿå¹¶ç”Ÿæˆåˆ›ä½œå»ºè®®', trigger: 'interval 5min', tools: ['github','feishu'], status: 'running', lastRun: '2026-02-20 17:05', prompt: 'æ£€æŸ¥çµæ„Ÿç”Ÿæˆå»ºè®®...' },
            { id: 3, name: 'AIå­¦ä¹ æé†’', desc: 'æ¯å¤©10:00æé†’å­¦ä¹ ', trigger: 'cron 0 10 * * *', tools: ['feishu'], status: 'pending', lastRun: '2026-02-20 10:00', prompt: 'æé†’å­¦ä¹ ...' },
            { id: 4, name: 'å‘¨æŠ¥ç”Ÿæˆ', desc: 'æ¯å‘¨ä¸€8:00ç”Ÿæˆå‘¨æŠ¥', trigger: 'cron 0 8 * * 1', tools: ['web_search','feishu','github'], status: 'pending', lastRun: '2026-02-16 08:00', prompt: 'ç”Ÿæˆå‘¨æŠ¥...' }
        ];

        // Load from localStorage
        function loadTasks() {
            const saved = localStorage.getItem('missionTasks');
            if (saved) tasks = JSON.parse(saved);
        }
        loadTasks();

        function saveTasks() {
            localStorage.setItem('missionTasks', JSON.stringify(tasks));
        }

        // Cron to human readable
        function formatSchedule(trigger) {
            if (!trigger) return 'æ‰‹åŠ¨';
            if (trigger === 'æ‰‹åŠ¨') return 'æ‰‹åŠ¨è§¦å‘';
            if (trigger.startsWith('interval')) {
                const mins = trigger.match(/(\d+)/);
                return mins ? `æ¯${mins[1]}åˆ†é’Ÿ` : trigger;
            }
            if (trigger.startsWith('cron')) {
                const expr = trigger.replace('cron ', '');
                // Common schedules
                if (expr === '0 7 * * *') return 'æ¯å¤© 7:00';
                if (expr === '0 10 * * *') return 'æ¯å¤© 10:00';
                if (expr === '0 8 * * 1') return 'æ¯å‘¨ä¸€ 8:00';
                if (expr === '0 0 * * *') return 'æ¯å¤© 0:00';
                if (expr === '*/5 * * * *') return 'æ¯5åˆ†é’Ÿ';
                if (expr === '*/15 * * * *') return 'æ¯15åˆ†é’Ÿ';
                if (expr === '*/30 * * * *') return 'æ¯30åˆ†é’Ÿ';
                return expr; // Return raw if not recognized
            }
            return trigger;
        }

        function render() {
            // Stats
            document.getElementById('totalTasks').textContent = tasks.length;
            document.getElementById('activeTasks').textContent = tasks.filter(t => t.status === 'running').length;
            document.getElementById('pendingTasks').textContent = tasks.filter(t => t.status === 'pending').length;
            document.getElementById('errorTasks').textContent = tasks.filter(t => t.status === 'error').length;

            // Task list
            const list = document.getElementById('taskList');
            if (tasks.length === 0) {
                list.innerHTML = '<div class="text-gray-500 text-center py-8">æš‚æ— ä»»åŠ¡ï¼Œç‚¹å‡»ä¸Šæ–¹"+ æ–°å»ºä»»åŠ¡"åˆ›å»º</div>';
                return;
            }

            list.innerHTML = tasks.map(t => `
                <div class="task-card glass rounded-xl p-4 flex justify-between items-center cursor-pointer hover:border-green-500/50" onclick="showTaskDetail(${t.id})">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <span class="text-white font-medium">${t.name}</span>
                            <span class="px-2 py-0.5 rounded-full text-xs ${
                                t.status === 'running' ? 'bg-green-500/20 text-green-400 status-running' :
                                t.status === 'error' ? 'bg-red-500/20 text-red-400' :
                                'bg-yellow-500/20 text-yellow-400'
                            }">${t.status === 'running' ? 'è¿è¡Œä¸­' : t.status === 'error' ? 'é”™è¯¯' : 'å¾…æ‰§è¡Œ'}</span>
                        </div>
                        <div class="text-gray-400 text-sm mt-1">${t.desc || 'æ— æè¿°'}</div>
                        <div class="text-gray-500 text-xs mt-1">â° ${formatSchedule(t.trigger)} | ğŸ”§ ${(t.tools || []).join(', ')}</div>
                    </div>
                    <div class="text-right flex flex-col gap-2">
                        <div class="text-gray-400 text-sm">ä¸Šæ¬¡: ${t.lastRun}</div>
                        <div class="flex gap-2">
                            <button onclick="event.stopPropagation(); editTask(${t.id})" class="btn-edit px-3 py-1 rounded-lg text-sm text-white">ç¼–è¾‘</button>
                            <button onclick="event.stopPropagation(); runTask(${t.id})" class="btn-success px-3 py-1 rounded-lg text-sm text-white">æ‰§è¡Œ</button>
                            <button onclick="event.stopPropagation(); deleteTask(${t.id})" class="bg-red-500/20 text-red-400 px-3 py-1 rounded-lg text-sm">åˆ é™¤</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function openNewTaskModal() {
            document.getElementById('modalTitle').textContent = 'â• æ–°å»ºä»»åŠ¡';
            document.getElementById('taskId').value = '';
            document.getElementById('taskForm').reset();
            document.getElementById('taskModal').classList.remove('hidden');
            document.getElementById('taskModal').classList.add('flex');
        }

        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            document.getElementById('modalTitle').textContent = 'âœï¸ ç¼–è¾‘ä»»åŠ¡';
            document.getElementById('taskId').value = task.id;
            document.getElementById('taskName').value = task.name;
            document.getElementById('taskDesc').value = task.desc || '';
            document.getElementById('taskPrompt').value = task.prompt || '';
            
            // Match schedule to preset or set custom
            const trigger = task.trigger;
            let matched = false;
            const presets = document.querySelectorAll('#schedulePreset option');
            presets.forEach(opt => {
                if (opt.value && trigger.includes(opt.value)) {
                    document.getElementById('schedulePreset').value = opt.value;
                    document.getElementById('schedule').value = opt.value;
                    document.getElementById('schedule').disabled = true;
                    matched = true;
                }
            });
            if (!matched) {
                document.getElementById('schedulePreset').value = '';
                document.getElementById('schedule').value = trigger;
                document.getElementById('schedule').disabled = false;
            }
            
            document.getElementById('outputTarget').value = task.output || 'feishu';
            
            // Check tools
            document.querySelectorAll('input[name="tools"]').forEach(cb => {
                cb.checked = (task.tools || []).includes(cb.value);
            });
            
            document.getElementById('taskModal').classList.remove('hidden');
            document.getElementById('taskModal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('taskModal').classList.add('hidden');
            document.getElementById('taskModal').classList.remove('flex');
        }

        function toggleSchedule() {
            const preset = document.getElementById('schedulePreset').value;
            const custom = document.getElementById('schedule');
            if (preset === 'manual') {
                custom.value = 'æ‰‹åŠ¨';
                custom.disabled = true;
            } else if (preset) {
                custom.value = preset;
                custom.disabled = true;
            } else {
                custom.disabled = false;
                custom.placeholder = 'å¦‚: æ¯å¤© 8ç‚¹';
            }
        }

        function saveTask(e) {
            e.preventDefault();
            const id = document.getElementById('taskId').value;
            const name = document.getElementById('taskName').value;
            const desc = document.getElementById('taskDesc').value;
            const prompt = document.getElementById('taskPrompt').value;
            const schedulePreset = document.getElementById('schedulePreset').value;
            let schedule = document.getElementById('schedule').value;
            const output = document.getElementById('outputTarget').value;
            const tools = Array.from(document.querySelectorAll('input[name="tools"]:checked')).map(cb => cb.value);

            // Use preset or custom input
            if (schedulePreset === 'manual') {
                schedule = 'æ‰‹åŠ¨';
            } else if (schedulePreset && !schedule.startsWith('å¦‚')) {
                schedule = schedulePreset;
            }

            if (id) {
                // Edit existing
                const task = tasks.find(t => t.id === parseInt(id));
                if (task) {
                    task.name = name;
                    task.desc = desc;
                    task.prompt = prompt;
                    task.trigger = schedule;
                    task.tools = tools.length ? tools : ['manual'];
                    task.output = output;
                }
            } else {
                // New task
                tasks.push({
                    id: Date.now(),
                    name,
                    desc,
                    prompt,
                    trigger: schedule || 'æ‰‹åŠ¨',
                    tools: tools.length ? tools : ['manual'],
                    output,
                    status: 'pending',
                    lastRun: '-'
                });
            }

            saveTasks();
            render();
            closeModal();
        }

        function runTask(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.status = 'running';
                task.lastRun = new Date().toLocaleString('zh-CN');
                render();
                saveTasks();
                // Simulate completion
                setTimeout(() => {
                    task.status = 'pending';
                    render();
                    saveTasks();
                }, 3000);
            }
        }

        function deleteTask(id) {
            if (confirm('ç¡®å®šåˆ é™¤è¿™ä¸ªä»»åŠ¡å—ï¼Ÿ')) {
                tasks = tasks.filter(t => t.id !== id);
                saveTasks();
                render();
            }
        }

        // Auto-refresh
        render();
        setInterval(render, 5000);

        // Tool details data
        const toolDetails = {
            browser: {
                name: 'ğŸŒ Browser æµè§ˆå™¨',
                desc: 'æ§åˆ¶ç½‘é¡µæµè§ˆå™¨è¿›è¡Œè‡ªåŠ¨åŒ–æ“ä½œ',
                features: [
                    'æ‰“å¼€ç½‘é¡µã€ç‚¹å‡»å…ƒç´ ã€å¡«å†™è¡¨å•',
                    'æˆªå›¾å’Œé¡µé¢å¿«ç…§',
                    'æ— å¤´æ¨¡å¼(Headless)å’Œæœ‰å¤´æ¨¡å¼',
                    'Cookieå’Œä¼šè¯ç®¡ç†'
                ],
                commands: ['browser open', 'browser click', 'browser screenshot', 'browser snapshot']
            },
            web_search: {
                name: 'ğŸ” Web Search æœç´¢',
                desc: 'ä½¿ç”¨Brave Search APIè¿›è¡Œç½‘ç»œæœç´¢',
                features: [
                    'å®æ—¶ç½‘é¡µæœç´¢',
                    'æŒ‰æ—¶é—´è¿‡æ»¤(24h/å‘¨/æœˆ)',
                    'ä¸­è‹±æ–‡æœç´¢æ”¯æŒ',
                    'ç»“æœå»é‡å’Œæ’åº'
                ],
                commands: ['web_search query="å…³é”®è¯"']
            },
            rss: {
                name: 'ğŸ“° RSS è®¢é˜…',
                desc: 'ç›‘æ§RSSè®¢é˜…æºè·å–æ›´æ–°',
                features: [
                    'è‡ªå®šä¹‰è®¢é˜…æºåˆ—è¡¨',
                    'å®šæ—¶æŠ“å–æ›´æ–°',
                    'æ”¯æŒAtomå’ŒRSSæ ¼å¼',
                    'å…³é”®è¯è¿‡æ»¤'
                ],
                commands: ['è¿è¡Œ rss-monitor-v2.py']
            },
            twitter: {
                name: 'ğŸ¦ Twitter/X',
                desc: 'è¯»å†™Twitter/Xå¹³å°å†…å®¹',
                features: [
                    'è¯»å–ç”¨æˆ·æ¨æ–‡',
                    'æœç´¢è¯é¢˜å’Œå…³é”®è¯',
                    'å‘å¸–å’Œå›å¤',
                    'ç›‘æ§ç‰¹å®šè´¦å·'
                ],
                commands: ['bird read', 'bird post', 'bird search']
            },
            feishu: {
                name: 'ğŸ’¬ Feishu é£ä¹¦',
                desc: 'é£ä¹¦æ¶ˆæ¯å’Œæ–‡æ¡£ç®¡ç†',
                features: [
                    'å‘é€å’Œæ¥æ”¶æ¶ˆæ¯',
                    'åˆ›å»º/ç¼–è¾‘æ–‡æ¡£',
                    'æ“ä½œé£ä¹¦è¡¨æ ¼(Bitable)',
                    'ç®¡ç†çŸ¥è¯†åº“wiki'
                ],
                commands: ['message send', 'feishu_doc', 'feishu_bitable']
            },
            cron: {
                name: 'â° Cron å®šæ—¶',
                desc: 'å®šæ—¶ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿ',
                features: [
                    'Cronè¡¨è¾¾å¼é…ç½®',
                    'é—´éš”æ‰§è¡Œ(æ¯Xåˆ†é’Ÿ)',
                    'ä¸€æ¬¡æ€§å®šæ—¶(at)',
                    'ä»»åŠ¡çŠ¶æ€ç›‘æ§'
                ],
                commands: ['cron add', 'cron list', 'cron run']
            },
            exec: {
                name: 'ğŸ’» Exec å‘½ä»¤è¡Œ',
                desc: 'æ‰§è¡Œæœ¬åœ°å‘½ä»¤è¡ŒæŒ‡ä»¤',
                features: [
                    'Shellå‘½ä»¤æ‰§è¡Œ',
                    'åå°è¿›ç¨‹ç®¡ç†',
                    'ç¯å¢ƒå˜é‡æ§åˆ¶',
                    'è¶…æ—¶å’Œæƒé™ç®¡ç†'
                ],
                commands: ['exec command="..."']
            },
            memory: {
                name: 'ğŸ“ Memory è®°å¿†',
                desc: 'é•¿æœŸè®°å¿†å­˜å‚¨ç³»ç»Ÿ',
                features: [
                    'è¯­ä¹‰æœç´¢è®°å¿†',
                    'æ¯æ—¥å·¥ä½œæ—¥å¿—',
                    'é•¿æœŸè®°å¿†(MEMORY.md)',
                    'ä¸Šä¸‹æ–‡ç»§æ‰¿'
                ],
                commands: ['memory_search', 'memory_get']
            },
            github: {
                name: 'ğŸ™ GitHub',
                desc: 'Gitä»“åº“å’ŒGitHubæ“ä½œ',
                features: [
                    'ä»“åº“åˆ›å»ºå’Œç®¡ç†',
                    'æ–‡ä»¶è¯»å†™(APIæˆ–git)',
                    'GitHub Actionsè§¦å‘',
                    'Pagesç½‘ç«™éƒ¨ç½²'
                ],
                commands: ['gh repo', 'git push', 'GitHub API']
            },
            email: {
                name: 'ğŸ“§ Email é‚®ä»¶',
                desc: 'IMAP/SMTPé‚®ä»¶æ”¶å‘',
                features: [
                    'å¤šè´¦æˆ·æ”¯æŒ',
                    'å‘é€é‚®ä»¶(æ”¯æŒHTML)',
                    'è¯»å–å’Œæœç´¢é‚®ä»¶',
                    'é™„ä»¶å¤„ç†'
                ],
                commands: ['himalaya list', 'himalaya send']
            },
            cloud: {
                name: 'â˜ï¸ Cloud äº‘ç›˜',
                desc: 'iCloudäº‘ç›˜æ“ä½œ',
                features: [
                    'æ–‡ä»¶ä¸Šä¼ ä¸‹è½½',
                    'æ–‡ä»¶å¤¹ç®¡ç†',
                    'è·¨è®¾å¤‡åŒæ­¥',
                    'æ–‡ä»¶åˆ†äº«é“¾æ¥'
                ],
                commands: ['icloud drive', 'openclaw nodes']
            },
            ai: {
                name: 'ğŸ¤– AI å¤§æ¨¡å‹',
                desc: 'è°ƒç”¨å¤§è¯­è¨€æ¨¡å‹',
                features: [
                    'å¤šæ¨¡å‹æ”¯æŒ(MiniMax/GPT/Claude)',
                    'å¯¹è¯å’Œæ¨ç†æ¨¡å¼',
                    'Function Calling',
                    'å¤šæ¨¡æ€(å›¾ç‰‡ç†è§£)'
                ],
                commands: ['ç›´æ¥å¯¹è¯å³å¯']
            }
        };

        function showToolDetail(toolId) {
            const tool = toolDetails[toolId];
            if (!tool) return;
            
            document.getElementById('toolDetailTitle').textContent = tool.name;
            document.getElementById('toolDetailDesc').textContent = tool.desc;
            
            document.getElementById('toolDetailFeatures').innerHTML = tool.features.map(f => 
                `<li class="text-gray-300">${f}</li>`
            ).join('');
            
            document.getElementById('toolDetailCommands').innerHTML = tool.commands.map(c => 
                `<code class="block bg-black/30 px-2 py-1 rounded text-green-400 text-sm mb-1">${c}</code>`
            ).join('');
            
            document.getElementById('toolModal').classList.remove('hidden');
            document.getElementById('toolModal').classList.add('flex');
        }

        function showTaskDetail(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            const toolIcons = {
                browser: 'ğŸŒ', web_search: 'ğŸ”', rss: 'ğŸ“°', twitter: 'ğŸ¦',
                feishu: 'ğŸ’¬', github: 'ğŸ™', exec: 'ğŸ’»', memory: 'ğŸ“', cron: 'â°'
            };
            
            const toolNames = {
                browser: 'æµè§ˆå™¨', web_search: 'æœç´¢', rss: 'RSSè®¢é˜…', twitter: 'Twitter',
                feishu: 'é£ä¹¦', github: 'GitHub', exec: 'å‘½ä»¤è¡Œ', memory: 'è®°å¿†', cron: 'å®šæ—¶'
            };
            
            // Build data flow diagram
            const flowSteps = [];
            flowSteps.push({icon: 'â°', label: 'è§¦å‘', desc: formatSchedule(task.trigger)});
            (task.tools || []).forEach(tool => {
                flowSteps.push({icon: toolIcons[tool] || 'ğŸ”§', label: toolNames[tool] || tool, desc: 'æ‰§è¡Œä¸­'});
            });
            if (task.output === 'feishu' || task.output === 'both') {
                flowSteps.push({icon: 'ğŸ’¬', label: 'é£ä¹¦', desc: 'å‘é€ç»“æœ'});
            }
            if (task.output === 'github' || task.output === 'both') {
                flowSteps.push({icon: 'ğŸ™', label: 'GitHub', desc: 'ä¿å­˜æ•°æ®'});
            }
            
            let html = `
                <div class="space-y-4">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${task.status === 'running' ? 'ğŸŸ¢' : task.status === 'error' ? 'ğŸ”´' : 'ğŸŸ¡'}</span>
                        <div>
                            <h3 class="text-xl font-bold text-white">${task.name}</h3>
                            <p class="text-gray-400 text-sm">${task.desc || 'æ— æè¿°'}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/5 rounded-lg p-3">
                            <div class="text-gray-400 text-xs">æ‰§è¡Œé¢‘ç‡</div>
                            <div class="text-white">${formatSchedule(task.trigger)}</div>
                        </div>
                        <div class="bg-white/5 rounded-lg p-3">
                            <div class="text-gray-400 text-xs">ä¸Šæ¬¡è¿è¡Œ</div>
                            <div class="text-white">${task.lastRun || '-'}</div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="text-gray-400 text-xs mb-2">ä½¿ç”¨å·¥å…·</div>
                        <div class="flex flex-wrap gap-2">
                            ${(task.tools || []).map(t => `<span class="bg-white/10 px-2 py-1 rounded text-sm">${toolIcons[t]||''} ${toolNames[t]||t}</span>`).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <div class="text-gray-400 text-xs mb-2">ğŸ“Š æ•°æ®æµå›¾</div>
                        <div class="flex items-center justify-between gap-2 overflow-x-auto py-2">
                            ${flowSteps.map((s, i) => `
                                <div class="flex items-center">
                                    <div class="bg-white/10 rounded-lg p-2 text-center min-w-[60px]">
                                        <div class="text-lg">${s.icon}</div>
                                        <div class="text-xs text-gray-300">${s.label}</div>
                                    </div>
                                    ${i < flowSteps.length - 1 ? '<div class="text-gray-500 mx-1">â†’</div>' : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${task.prompt ? `
                    <div>
                        <div class="text-gray-400 text-xs mb-1">Prompt æŒ‡ä»¤</div>
                        <div class="bg-black/30 rounded-lg p-3 text-sm text-gray-300 max-h-32 overflow-y-auto">${task.prompt}</div>
                    </div>
                    ` : ''}
                    
                    <div class="flex gap-3 pt-2">
                        <button onclick="closeDetailModal(); editTask(${task.id})" class="flex-1 btn-edit py-2 rounded-lg text-white text-sm">ç¼–è¾‘ä»»åŠ¡</button>
                        <button onclick="closeDetailModal(); runTask(${task.id})" class="flex-1 btn-success py-2 rounded-lg text-white text-sm">ç«‹å³æ‰§è¡Œ</button>
                    </div>
                </div>
            `;
            
            document.getElementById('detailContent').innerHTML = html;
            document.getElementById('detailModal').classList.remove('hidden');
            document.getElementById('detailModal').classList.add('flex');
        }

        function closeDetailModal() {
            document.getElementById('detailModal').classList.add('hidden');
            document.getElementById('detailModal').classList.remove('flex');
        }
    </script>

    <!-- Task Detail Modal -->
    <div id="detailModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center p-4 z-50" onclick="closeDetailModal()">
        <div class="glass p-6 w-full max-w-lg" onclick="event.stopPropagation()">
            <div id="detailContent"></div>
        </div>
    </div>
            const tool = toolDetails[toolId];
            if (!tool) return;
            
            document.getElementById('toolDetailTitle').textContent = tool.name;
            document.getElementById('toolDetailDesc').textContent = tool.desc;
            
            document.getElementById('toolDetailFeatures').innerHTML = tool.features.map(f => 
                `<li class="text-gray-300">${f}</li>`
            ).join('');
            
            document.getElementById('toolDetailCommands').innerHTML = tool.commands.map(c => 
                `<code class="block bg-black/30 px-2 py-1 rounded text-green-400 text-sm mb-1">${c}</code>`
            ).join('');
            
            document.getElementById('toolModal').classList.remove('hidden');
            document.getElementById('toolModal').classList.add('flex');
        }

        function closeToolModal() {
            document.getElementById('toolModal').classList.add('hidden');
            document.getElementById('toolModal').classList.remove('flex');
        }
    </script>

    <!-- Tool Detail Modal -->
    <div id="toolModal" class="fixed inset-0 bg-black/70 hidden items-center justify-center p-4 z-50" onclick="closeToolModal()">
        <div class="glass p-6 w-full max-w-lg" onclick="event.stopPropagation()">
            <h2 id="toolDetailTitle" class="text-2xl font-bold text-white mb-2">å·¥å…·åç§°</h2>
            <p id="toolDetailDesc" class="text-gray-400 mb-4">å·¥å…·æè¿°</p>
            
            <div class="mb-4">
                <h3 class="text-lg font-medium text-white mb-2">âœ¨ åŠŸèƒ½</h3>
                <ul id="toolDetailFeatures" class="list-disc list-inside text-gray-300 space-y-1"></ul>
            </div>
            
            <div>
                <h3 class="text-lg font-medium text-white mb-2">ğŸ’» ä½¿ç”¨æ–¹å¼</h3>
                <div id="toolDetailCommands"></div>
            </div>
            
            <button onclick="closeToolModal()" class="mt-6 w-full btn-primary p-3 rounded-xl text-white font-medium">å…³é—­</button>
        </div>
    </div>
</body>
</html>
